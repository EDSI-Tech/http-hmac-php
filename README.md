# HMAC Request Signer

A PHP library that signs HTTP requests using a HMAC digest. The algorithm is
heavily inspired by [Amazon Web Service's](http://docs.aws.amazon.com/AmazonS3/latest/dev/RESTAuthentication.html)
implementation.

The goal of this project is to generate a digest from common HTTP request
objects, e.g. [Guzzle](http://api.guzzlephp.org/class-Guzzle.Http.Message.Request.html)
and [Symfony](http://api.symfony.com/2.0/Symfony/Component/HttpFoundation/Request.html),
so that it can be reused in client-side and server-side implementations.

The following pseudocode illustrates the construction of the Authorization
header and signature.

```
Authorization = "Acquia" + " " + ID + ":" + Signature;

Signature = Base64( HMAC-SHA1 )( SecretKey, Message ) );

Message =
    HTTP-Verb + "\n" +
	MD5( Request-Body ) + "\n" +
	Content-Type + "\n" +
	Date + "\n" +
	Resource
;
```

`ID` is the API key's unique identifer, such as the one generated by the
[API Key Manager](https://github.com/acquia/api-key-manager) library. `Date` is
either the value of the `Date` HTTP header or a custom header defined by the
application, e.g. `x-acquia-timestamp`. `Resource` is the request path + query
string.

## Installation

HMAC Request can be installed with [Composer](http://getcomposer.org)
by adding it as a dependency to your project's composer.json file.

```json
{
    "repositories": [
        {
            "type": "vcs",
            "url": "https://github.com/acquia/hmac-request"
        }
    ],
    "require": {
        "acquia/hmac-request": "*"
    }
}
```

Please refer to [Composer's documentation](https://github.com/composer/composer/blob/master/doc/00-intro.md#introduction)
for more detailed installation and usage instructions.

## Usage

Generate a signature from a Guzzle request.

```php

use Acquia\Hmac\RequestSigner;
use Acquia\Hmac\Request as Request;

// $guzzleRequest is a \Guzzle\Http\Message\Request object.
$request = new Request\Guzzle3($guzzleRequest);

$signer = new RequestSigner();
$signature = $signer->signRequest($request, 'secretKey');

```

Get the signature passed through the HTTP request in a Symfony-powered app e.g.
[Silex](https://github.com/silexphp/Silex).

```php

use Acquia\Hmac\RequestSigner;
use Acquia\Hmac\Request as Request;

// $symfonyRequest is a \Symfony\Component\HttpFoundation\Request object.
$request = new Request\Symfony($symfonyRequest);

$signer = new RequestSigner();
$signature = $signer->getSignature($request);

```

## Attribution

The techniques in this library were adapted from the work done by Peter Wolanin,
Jacob Singh, and Nick Veenhof for the [Acquia Search](https://www.acquia.com/products-services/acquia-network/cloud-services/acquia-search)
project.
