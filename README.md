# HMAC Request Signer

A PHP library that signs HTTP requests using a HMAC digest. The algorithm is
heavily inspired by [Amazon Web Service's](http://docs.aws.amazon.com/AmazonS3/latest/dev/RESTAuthentication.html)
implementation and derived from the HMAC authentication system developed for
[Acquia Search](https://www.acquia.com/products-services/acquia-network/cloud-services/acquia-search).

The goal of this project is to generate a digest from common HTTP request
objects, e.g. [Guzzle](http://api.guzzlephp.org/class-Guzzle.Http.Message.Request.html)
and [Symfony](http://api.symfony.com/2.0/Symfony/Component/HttpFoundation/Request.html),
so that it can be reused in client-side and server-side implementations.

The following pseudocode illustrates the construction of the Authorization
header and signature.

```
Authorization = "Acquia" + " " + ID + ":" + Signature;

Signature = Base64( HMAC-SHA1 )( SecretKey, Message ) );

Message =
    HTTP-Verb + "\n" +
	MD5( Request-Body ) + "\n" +
	Content-Type + "\n" +
	Date + "\n" +
    Custom headers + "\n"
	Resource
;
```

`ID` is the API key's unique identifer, such as the one generated by the
[API Key Manager](https://github.com/acquia/api-key-manager) library. `Date` is
either the value of the `Date` HTTP header or a custom header defined by the
application, e.g. `x-acquia-timestamp`. `Resource` is the request path + query
string.

@todo Document `Custom headers`

## Installation

HMAC Request can be installed with [Composer](http://getcomposer.org)
by adding it as a dependency to your project's composer.json file.

```json
{
    "repositories": [
        {
            "type": "vcs",
            "url": "https://github.com/acquia/hmac-request"
        }
    ],
    "require": {
        "acquia/hmac-request": "*"
    }
}
```

Please refer to [Composer's documentation](https://github.com/composer/composer/blob/master/doc/00-intro.md#introduction)
for more detailed installation and usage instructions.

## Usage

Sign an API request sent via Guzzle.

```php

use Acquia\Hmac\Guzzle3\HmacAuthPlugin;
use Acquia\Hmac\RequestSigner;
use Guzzle\Http\Client;

$requestSigner = new RequestSigner();
$plugin = new HmacAuthPlugin(requestSigner, 'apiKeyId', 'secretKey');

$client = new Client('http://example.com');
$client->addSubscriber(plugin);

$client->get('/resource')->send();

```

Authenticate the request in a Symfony-powered app e.g. [Silex](https://github.com/silexphp/Silex).

```php

use Acquia\Hmac\RequestAuthenticator;
use Acquia\Hmac\RequestSigner;
use Acquia\Hmac\Request\Symfony as RequestWrapper;

// $request is a \Symfony\Component\HttpFoundation\Request object.
$requestWrapper = new RequestWrapper($request);

// $keyLoader implements \Acquia\Hmac\KeyLoaderInterface

$authenticator = new RequestAuthenticator(new RequestSigner(), '+15 minutes');
$key = $authenticator->authenticate($requestWrapper, $keyLoader);

```

## Attribution

The techniques in this library were adapted from the work done by Peter Wolanin,
Jacob Singh, and Nick Veenhof for the [Acquia Search](https://www.acquia.com/products-services/acquia-network/cloud-services/acquia-search)
project.
